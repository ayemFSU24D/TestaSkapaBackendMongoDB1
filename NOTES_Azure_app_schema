
3Ô∏è‚É£ Arkitekturf√∂rslag
Frontend (React)
  ‚îî‚îÄ Azure Static Web App
       ‚îî‚îÄ Anropar Backend API

Backend (Node.js + Express)
  ‚îî‚îÄ Azure Container App
       ‚îî‚îÄ Anv√§nder MONGO_URL

Databas (MongoDB)
  ‚îî‚îÄ Azure Cosmos DB (MongoDB API)


ACA klarar autoskalning f√∂r backend

Frontend klarar autoskalning via Static Web Apps

Cosmos DB √§r fullt hanterad ‚Üí skalning och backup










----------------------------------------gammal exempeltext nedan----------------------------------------
‚úî YAML till Azure
‚úî Autoscaling (baserat p√• CPU eller HTTP)
‚úî MongoDB-container i Azure (med persistent storage)
‚úî Backend som pratar med MongoDB via intern adress
‚úî TLS-adresser s√• du kan ansluta med Mongo Compass

üü¶ 1. Din lokala docker-compose (som du redan har)

Den anv√§nder du bara lokalt ‚Äî allt √§r r√§tt.

services:
  mongo:
    image: mongo:latest
    restart: no
    ports:
      - 27017:27017
    volumes:
      - mongodata:/data/db

volumes:
  mongodata:

üü¶ 2. Azure Container Apps ‚Äì YAML f√∂r backend + MongoDB

Detta √§r deploy-klart.

‚úî azure-app.yaml (backend)
name: my-backend
type: containerapp
location: westeurope
properties:
  environmentId: /subscriptions/<SUB_ID>/resourceGroups/<RG>/providers/Microsoft.Web/containerApps/<ENV>
  configuration:
    ingress:
      external: true
      targetPort: 3000
    secrets:
      - name: mongo-url
        value: mongodb://mongo-service:27017
  template:
    containers:
      - name: backend
        image: ghcr.io/<ditt-konto>/<backend-image>:latest
        env:
          - name: MONGO_URL
            secretRef: mongo-url
    scale:
      minReplicas: 1
      maxReplicas: 10
      rules:
        - name: http-scale
          http:
            metadata:
              concurrentRequests: "100"

‚úî azure-mongo.yaml (MongoDB i Azure Container Apps)**

Detta √§r samma sak som din docker-compose, fast i Azure-form.

name: mongo-service
type: containerapp
location: westeurope
properties:
  environmentId: /subscriptions/<SUB_ID>/resourceGroups/<RG>/providers/Microsoft.Web/containerApps/<ENV>
  configuration:
    ingress:
      external: true
      targetPort: 27017
    secrets: []
    volumes:
      - name: mongodata
        storageType: azureFile
        path: /data/db
  template:
    containers:
      - name: mongo
        image: mongo:latest
        volumeMounts:
          - volumeName: mongodata
            mountPath: /data/db
    scale:
      minReplicas: 1
      maxReplicas: 3
      rules:
        - name: cpu-scale
          custom:
            type: cpu
            metadata:
              threshold: "80"

üü¶ 3. S√• kopplar backend ‚Üí Azure MongoDB

I backend k√∂r du:

const client = new MongoClient(process.env.MONGO_URL);


Azure injicerar:

mongodb://mongo-service:27017


üü© mongo-service = namnet p√• MongoDB-containerappen i Azure
üü© Intern DNS ‚Üí backend hittar MongoDB automatiskt

üü¶ 4. L√§nka MongoDB i Azure till Mongo Compass

Eftersom vi satte:

ingress:
  external: true
  targetPort: 27017


kommer Azure skapa en publik adress, t.ex.:

https://mongo-service.greenfall-1234.europe.azurecontainerapps.io


Men MongoDB kr√§ver r√• TCP, inte HTTP, s√• du m√•ste skapa en extern TCP-ingress:

‚úî K√∂r i Azure CLI:
az containerapp ingress enable \
  --name mongo-service \
  --resource-group <RG> \
  --type external \
  --transport tcp \
  --target-port 27017


D√• f√•r du:

tcp://mongo-service.<env>.azurecontainerapps.io:27017

Sedan i Mongo Compass skriver du:
mongodb://mongo-service.<ENV>.azurecontainerapps.io:27017

üü¶ 5. S√• deployar du
az containerapp create --file azure-mongo.yaml
az containerapp create --file azure-app.yaml

üü© Sammanfattning
Del	Lokal Docker	Azure
MongoDB	docker-compose	azure-mongo.yaml
Backend	npm start	azure-app.yaml
Autoscaling	‚ùå	‚úî CPU / HTTP
Mongo Compass	localhost:27017	mongo-service.<env>.io:27017