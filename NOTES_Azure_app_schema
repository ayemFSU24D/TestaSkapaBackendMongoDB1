
3ï¸âƒ£ ArkitekturfÃ¶rslag
Frontend (React)
  â””â”€ Azure Static Web App
       â””â”€ Anropar Backend API

Backend (Node.js + Express)
  â””â”€ Azure Container App
       â””â”€ AnvÃ¤nder MONGO_URL

Databas (MongoDB)
  â””â”€ Azure Cosmos DB (MongoDB API)


ACA klarar autoskalning fÃ¶r backend

Frontend klarar autoskalning via Static Web Apps

Cosmos DB Ã¤r fullt hanterad â†’ skalning och backup




--------------------------den Ã¤r strukturen som Azure fÃ¶rvÃ¤ntar sig nÃ¤r man anvÃ¤nder backend och frontend i samma repo---------------

myrepo/
â”‚
â”œâ”€â”€ frontend/       â† React, Vite, Next etc.
â”‚    â”œâ”€â”€ package.json
â”‚    â””â”€â”€ src/
â”‚
â””â”€â”€ backend/        â† Node.js API (Express)
     â”œâ”€â”€ Dockerfile   â† anvÃ¤nds fÃ¶r Container App
     â””â”€â”€ index.js










----------------------------------------gammal exempeltext nedan----------------------------------------
âœ” YAML till Azure
âœ” Autoscaling (baserat pÃ¥ CPU eller HTTP)
âœ” MongoDB-container i Azure (med persistent storage)
âœ” Backend som pratar med MongoDB via intern adress
âœ” TLS-adresser sÃ¥ du kan ansluta med Mongo Compass

ğŸŸ¦ 1. Din lokala docker-compose (som du redan har)

Den anvÃ¤nder du bara lokalt â€” allt Ã¤r rÃ¤tt.

services:
  mongo:
    image: mongo:latest
    restart: no
    ports:
      - 27017:27017
    volumes:
      - mongodata:/data/db

volumes:
  mongodata:

ğŸŸ¦ 2. Azure Container Apps â€“ YAML fÃ¶r backend + MongoDB

Detta Ã¤r deploy-klart.

âœ” azure-app.yaml (backend)
name: my-backend
type: containerapp
location: westeurope
properties:
  environmentId: /subscriptions/<SUB_ID>/resourceGroups/<RG>/providers/Microsoft.Web/containerApps/<ENV>
  configuration:
    ingress:
      external: true
      targetPort: 3000
    secrets:
      - name: mongo-url
        value: mongodb://mongo-service:27017
  template:
    containers:
      - name: backend
        image: ghcr.io/<ditt-konto>/<backend-image>:latest
        env:
          - name: MONGO_URL
            secretRef: mongo-url
    scale:
      minReplicas: 1
      maxReplicas: 10
      rules:
        - name: http-scale
          http:
            metadata:
              concurrentRequests: "100"

âœ” azure-mongo.yaml (MongoDB i Azure Container Apps)**

Detta Ã¤r samma sak som din docker-compose, fast i Azure-form.

name: mongo-service
type: containerapp
location: westeurope
properties:
  environmentId: /subscriptions/<SUB_ID>/resourceGroups/<RG>/providers/Microsoft.Web/containerApps/<ENV>
  configuration:
    ingress:
      external: true
      targetPort: 27017
    secrets: []
    volumes:
      - name: mongodata
        storageType: azureFile
        path: /data/db
  template:
    containers:
      - name: mongo
        image: mongo:latest
        volumeMounts:
          - volumeName: mongodata
            mountPath: /data/db
    scale:
      minReplicas: 1
      maxReplicas: 3
      rules:
        - name: cpu-scale
          custom:
            type: cpu
            metadata:
              threshold: "80"

ğŸŸ¦ 3. SÃ¥ kopplar backend â†’ Azure MongoDB

I backend kÃ¶r du:

const client = new MongoClient(process.env.MONGO_URL);


Azure injicerar:

mongodb://mongo-service:27017


ğŸŸ© mongo-service = namnet pÃ¥ MongoDB-containerappen i Azure
ğŸŸ© Intern DNS â†’ backend hittar MongoDB automatiskt

ğŸŸ¦ 4. LÃ¤nka MongoDB i Azure till Mongo Compass

Eftersom vi satte:

ingress:
  external: true
  targetPort: 27017


kommer Azure skapa en publik adress, t.ex.:

https://mongo-service.greenfall-1234.europe.azurecontainerapps.io


Men MongoDB krÃ¤ver rÃ¥ TCP, inte HTTP, sÃ¥ du mÃ¥ste skapa en extern TCP-ingress:

âœ” KÃ¶r i Azure CLI:
az containerapp ingress enable \
  --name mongo-service \
  --resource-group <RG> \
  --type external \
  --transport tcp \
  --target-port 27017


DÃ¥ fÃ¥r du:

tcp://mongo-service.<env>.azurecontainerapps.io:27017

Sedan i Mongo Compass skriver du:
mongodb://mongo-service.<ENV>.azurecontainerapps.io:27017

ğŸŸ¦ 5. SÃ¥ deployar du
az containerapp create --file azure-mongo.yaml
az containerapp create --file azure-app.yaml

ğŸŸ© Sammanfattning
Del	Lokal Docker	Azure
MongoDB	docker-compose	azure-mongo.yaml
Backend	npm start	azure-app.yaml
Autoscaling	âŒ	âœ” CPU / HTTP
Mongo Compass	localhost:27017	mongo-service.<env>.io:27017